---
layout: default
title: sizzle阅读记
---
最近想看点儿框架之内的代码充实一下，于是选择了sizzle这个框架，很喜欢jQuery的风格，一有时间就记记。

### faster indexOf

```javascript
// #line 61 http://jsperf.com/thor-indexof-vs-for/5
var indexOf = function( list, elem ) {
	var i = 0,
	  len = list.length;
	for ( ; i < len; i++ ) {
		if ( list[i] === elem ) {
			return i;
		}
	}
	return -1;
}
```
在现代浏览器中，此方法的效率比原生数组的indexOf效率高许多，我以前一直认为原生的比自己写的效率高，看来读书太少~


### 所有的node类型：

> 
 + Node.ELEMENT_NODE(1)；
 + Node.ATTRIBUTE_NODE(2)；
 + Node.TEXT_NODE(3)；
 + Node.CDATA_SECTION_NODE(4)；
 + Node.ENTITY_REFERENCE_NODE(5)；
 + Node.ENTITY_NODE(6)；
 + Node.PROCESSING_INSTRUCTION_NODE(7)；
 + Node.COMMENT_NODE(8)；
 + Node.DOCUMENT_NODE(9)；
 + Node.DOCUMENT_TYPE_NODE(10)；
 + Node.DOCUMENT_FRAGMENT_NODE(11)；
 + Node.NOTATION_NODE(12)。


```javascript
getText = Sizzle.getText = function( elem ) {
	var node,
		ret = "",
		i = 0,
		nodeType = elem.nodeType;

	if ( !nodeType ) {
		// If no nodeType, this is expected to be an array
		while ( (node = elem[i++]) ) {
			// Do not traverse comment nodes
			ret += getText( node );
		}
	} else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {
		// Use textContent for elements
		// innerText usage removed for consistency of new lines (jQuery #11153)
		if ( typeof elem.textContent === "string" ) {
			return elem.textContent;
		} else {
			// Traverse its children
			for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
				ret += getText( elem );
			}
		}
	} else if ( nodeType === 3 || nodeType === 4 ) {
		return elem.nodeValue;
	}
	// Do not include comment or processing instruction nodes

	return ret;
};
```

### 判断是否为XML

```javascript
/**
 * Detects XML nodes
 * @param {Element|Object} elem An element or a document
 * @returns {Boolean} True iff elem is a non-HTML XML node
 */
isXML = Sizzle.isXML = function( elem ) {
	// documentElement is verified for cases where it doesn't yet exist
	// (such as loading iframes in IE - #4833)
	var documentElement = elem && (elem.ownerDocument || elem).documentElement;
	return documentElement ? documentElement.nodeName !== "HTML" : false;
};
```
